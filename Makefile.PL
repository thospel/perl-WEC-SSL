#!/usr/bin/perl -w
# $Id: Makefile.PL 2693 2008-01-02 09:54:19Z hospelt $
use 5.006001;
use strict;
use warnings;
use ExtUtils::MakeMaker;
use vars qw($VERSION);
$VERSION = "1.000";

WriteMakefile
    (NAME		=> 'WEC::SSL',
     VERSION		=> '0.01',
     BUILD_REQUIRES	=> {
	 # Only for the tests
	 "Test::More"	=> "0.01",
     },
     PREREQ_PM		=> {
     },
     AUTHOR		=> 'Ton Hospel <WEC-SSL@ton.iguana.be>',
     $^O eq "MSWin32" ? (
         PM_FILTER	=> '$(PERL) -p -e1',
     ) : (),
     clean		=> {
         FILES => '$(DISTNAME).ppd ppm cover_db',
     },
);

# START MY
# autogenerated by release_pm
BEGIN {
    package MY;

    use vars qw(%postamble);

    $postamble{ppm} = <<'EOT';
ppm: $(DISTNAME).ppd
	makeppd.pl "--perl=$(PERLRUN)" --min_version=1.016 "--zip=$(ZIP)" "--tar=$(TAR)" "--compress=$(COMPRESS)" --leave=ppm "--objects=$(OBJECT)" $(DISTNAME).ppd $(VERSION)
EOT

    $postamble{ppm3} = <<'EOT';
ppm3: $(DISTNAME).ppd
	makeppd.pl "--perl=$(PERLRUN)" --min_version=1.016 "--zip=$(ZIP)" "--tar=$(TAR)" "--compress=$(COMPRESS)" --ppm_version=3 --leave=ppm3 "--objects=$(OBJECT)" $(DISTNAME).ppd $(VERSION)
EOT

    $postamble{ppm4} = <<'EOT';
ppm4: $(DISTNAME).ppd
	makeppd.pl "--perl=$(PERLRUN)" --min_version=1.016 "--zip=$(ZIP)" "--tar=$(TAR)" "--compress=$(COMPRESS)" --ppm_version=4 --leave=ppm4 "--objects=$(OBJECT)" $(DISTNAME).ppd $(VERSION)
EOT

    $postamble{ppd} = <<'EOT';
$(DISTNAME).ppd: all ppd
EOT

    $postamble{cover} = <<'EOT';
cover:
	cover -delete
	mkdir cover_db
	-HARNESS_PERL_SWITCHES=-MDevel::Cover make test
	cover
EOT

    $postamble{critic} = <<'EOT';
critic:
	perlcritic .
EOT

    $postamble{ppm_install} = <<'EOT';
ppm_install: ppm
	ppm install ppm/$(DISTNAME).ppd
EOT

    $postamble{ppm_uninstall} = <<'EOT';
ppm_uninstall:
	ppm uninstall $(DISTNAME)
EOT

undef &postamble;	## no critic (ProhibitUselessNoCritic ProhibitAmpersandSigils)
}
{
    package MY;
    sub postamble {
	return shift->SUPER::postamble() . join("\n", @postamble{sort {uc $a cmp uc $b || $a cmp $b } keys %postamble});
    }
}
# END MY

BEGIN {
package MY;
use vars qw(%postamble);

$postamble{ppport_h} = <<'EOF';
ppport:
	$(PERLRUN) -MDevel::PPPort -e "Devel::PPPort::WriteFile(qq(include/ppport.h))"
EOF

$postamble{ppport} = <<'EOF';
$(XS_FILES): ../include/ppport.h
	$(PERLRUN) ../include/ppport.h --copy .patched $(XS_FILES)
	$(PERLRUN) -e 'for (@ARGV) { local $$/; open(my $$in, "<", "$$_.patched") || die "Could not open \x27$$_.patched\x27: $$!"; my $$content = <$$in>; $$content =~ s{\Q#include "ppport.h"\E\n}{}; close($$in) || die "Error closing \x27$$_.patched\x27: $$!"; open(my $$out, ">", "$$_.patched") || die "Could not write to \x27$$_.patched\x27: $$!"; print($$out $$content) || die "Error writing to \x27$$_.patched\x27: $$!"; close($$out) || die "Could not close \x27$$_.patched\x27: $$!"; rename("$$_.patched", $$_) || die "Could not rename \x27$$_\x27 to \x27$$_\x27: $$!"; }' $(XS_FILES)

EOF
}
